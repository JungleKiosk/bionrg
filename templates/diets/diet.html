{% extends "base.html" %}

{% block title %}
{{ dieta }}
{% endblock %}
{% include 'partials/navbar.html' %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12 col-lg-4">
            <h1 class="mt-5">{{ dieta }}</h1>
            <form method="post">
                {% for ingrediente, limiti in ingredienti.items() %}
                <div class="form-group">
                    <label for="{{ ingrediente }}">{{ ingrediente.replace('_', ' ').capitalize() }} ({{ limiti[0] }} -
                        {{ limiti[1] }}%)</label>
                    <input type="number" class="form-control" id="{{ ingrediente }}" name="{{ ingrediente }}"
                        min="{{ limiti[0] }}" max="{{ limiti[1] }}" required
                        value="{{ input_values[ingrediente] if input_values else '' }}">
                </div>
                {% endfor %}
                <button type="submit" class="btn btn-primary mt-3">Calcola Dimensionamento Aziendale</button>
            </form>
        </div>
        {% if percentuali %}

        <div class="col-12 col-lg-8">
            <h2 class="mt-5">Risultati:</h2>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Parametro</th>
                            <th>Descrizione</th>
                            <th>Valore</th>
                            <th>um</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>E_el</td>
                            <td>Energia Elettrica Giornaliera</td>
                            <td>{{ E_el }}</td>
                            <td>kWh</td>
                        </tr>
                        <tr>
                            <td>M_ch4_tot</td>
                            <td>Metano Totale Necessario</td>
                            <td>{{ M_ch4_tot }}</td>
                            <td>Nm³</td>
                        </tr>
                        <tr>
                            <td>M_B_tot</td>
                            <td>Massa di Biogas Totale</td>
                            <td>{{ M_B_tot }}</td>
                            <td>ton</td>
                        </tr>
                        <tr>
                            <td>M_B_crop</td>
                            <td>Massa di Biogas da Insilato di Mais</td>
                            <td>{{ M_B_IT }}</td>
                            <td>ton</td>
                        </tr>
                        <tr>
                            <td>M_B_animal</td>
                            <td>Massa di Biogas da Liquame Bovino</td>
                            <td>{{ M_B_LS }}</td>
                            <td>ton</td>
                        </tr>
                        <tr>
                            <td>S_crop</td>
                            <td>Superficie Coltivata a Insilato di Mais</td>
                            <td>{{ S_IT }}</td>
                            <td>ha</td>
                        </tr>
                        <tr>
                            <td>A_capi</td>
                            <td>Numero di Capi di Bestiame</td>
                            <td>{{ A_capi }}</td>
                            <td>capi</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}
    </div>

    {% if percentuali %}
    <div class="row">
        <h1>Dimensionamento aziendale per un impianto a Biogas</h1>
        <h3>Processo di calcolo:</h3>
        <div class="col-12 col-lg-8">
            <p>
                Si consideri che l'algoritmo è calibrato con l'obbiettivo finale di produrre un megawatt ora al giorno
                (commissione progettuale). Dalle <a href="/specifiche">specifiche di
                progetto</a> (commissione progettuale) e dai <a href="/specifiche">tabulati dei parametri</a> si stima il dimensionamento aziendale
                attraverso il
                numero di capi di bestiame e la superficie a coltura energetica dedicata a Biogas.
            <p>
                L'equazione descrive
                l'energia elettrica giornaliera [E_el] necessaria per ottenere 1 MW ora al giorno (commissione
                progettuale).
            </p>
            <p>
                <a>P</a> = E_el/24 <br>
                E_el = P x 24 [kW x (ore/giorno)]<br><br>
                E_el = 1000 x 24 = <span>{{ E_el }}</span> kW/giorno<br>
                <span class="small">in cui P = potenza richiesta (commissione progettuale)</span>
            </p>
            <p>
                Si passare al calcolo del metano totale [M_ch4_tot] necessario per arrivare a produrre tale
                energia, attraverso i seguenti calcoli.
            </p>
            <p>
                E_el = M_ch4_tot x <a>H1</a> x <a>n</a> <br>
                M_ch4_tot = E_el/(H1 x n) [(kWh/giorno)/(kWh/Nm³)]<br><br>
                M_ch4_tot = 2400/(10 x 0.45) = <span>{{ M_ch4_tot }}</span> [Nm³/giorno]
            <p>
                <span class="small">in cui H1 = potere calorifero inferiore CH4 [kWh/Nm³], n = rendimento elettrico
                    [%]</span>
            </p>
            <p>
                Ora è possibile stimare il Biogas totale [M_B_tot].
                Considerando la <span>{{ dieta }}</span> selezionata e il
                relativo <a>Potenziale metanigeno</a> delle biomasse, si procede con il seguente rapporto:
            </p>
            <p>
                M_ch4_tot =
                M_B_tot*(phi_animal*Pg_animal*C_CH4_animal)+(phi_crop*Pg_crop*C_CH4_crop)+(phi_waste*Pg_waste*C_CH4_waste)
                [(Nm³/giorno)/(Nm³/tonn)] <br>
                M_B_tot =
                M_ch4_tot/(phi_animal*Pg_animal*C_CH4_animal)+(phi_crop*Pg_crop*C_CH4_crop)+(phi_waste*Pg_waste*C_CH4_waste)
                [(Nm³/giorno)/(Nm³/tonn)]
                <br>
                <br>
                M_B_tot = <span>{{ M_ch4_tot }}</span>/(<span>{{debug_info.phi_LS}}</span>*<span>{{ debug_info.Pg_LS
                    }}</span>*<span>{{
                    debug_info.C_CH4_LS }}</span>)+(<span>{{debug_info.phi_IT}}</span>*<span>{{ debug_info.Pg_IT
                    }}</span>*<span>{{ debug_info.C_CH4_IT }}</span>)+(<span>{{debug_info.phi_SF}}</span>*<span>{{
                    debug_info.Pg_SF
                    }}</span>*<span>{{ debug_info.C_CH4_SF }}</span>) = <span>{{ M_B_tot }}</span>[tonn/giorno] <br>
            </p>
            <p>
                Di seguito in tabella, parametri e valori relativi alla <span>{{dieta}}</span> scelta:
            </p>
        </div>
    </div>
    {% endif %}

    <!-- tabelle parametri -->
    {% if percentuali %}
    <div class="row">
        <div class="col-12">
            <h3 class="mt-5">Valori al Denominatore per la {{dieta}}</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Parametro</th>
                            <th>Descrizione</th>
                            <th>Ingrediente</th>
                            <th>Valore</th>
                            <th>um</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>phi_animal</td>
                            <td>Percentuale di ingrediente</td>
                            <td>{{ debug_info.phi_LS_name }}</td>
                            <td>{{ debug_info.phi_LS }}</td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td>phi_crop</td>
                            <td>Percentuale di ingrediente</td>
                            <td>{{ debug_info.phi_IT_name }}</td>
                            <td>{{ debug_info.phi_IT }}</td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td>phi_waste</td>
                            <td>Percentuale di ingrediente</td>
                            <td>{{ debug_info.phi_SF_name }}</td>
                            <td>{{ debug_info.phi_SF }}</td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td>Pg_animal</td>
                            <td>Potenziale prod. Biogas</td>
                            <td>{{ debug_info.phi_LS_name }}</td>
                            <td>{{ debug_info.Pg_LS }}</td>
                            <td>Nm³/t</td>
                        </tr>
                        <tr>
                            <td>Pg_crop</td>
                            <td>Potenziale prod. Biogas</td>
                            <td>{{ debug_info.phi_IT_name }}</td>
                            <td>{{ debug_info.Pg_IT }}</td>
                            <td>Nm³/t</td>
                        </tr>
                        <tr>
                            <td>Pg_waste</td>
                            <td>Potenziale prod. Biogas</td>
                            <td>{{ debug_info.phi_SF_name }}</td>
                            <td>{{ debug_info.Pg_SF }}</td>
                            <td>Nm³/t</td>
                        </tr>
                        <tr>
                            <td>C_CH4_animal</td>
                            <td>Volume CH4 nel Biogas</td>
                            <td>{{ debug_info.phi_LS_name }}</td>
                            <td>{{ debug_info.C_CH4_LS }}</td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td>C_CH4_crop</td>
                            <td>Volume CH4 nel Biogas</td>
                            <td>{{ debug_info.phi_IT_name }}</td>
                            <td>{{ debug_info.C_CH4_IT }}</td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td>C_CH4_waste</td>
                            <td>Volume CH4 nel Biogas</td>
                            <td>{{ debug_info.phi_SF_name }}</td>
                            <td>{{ debug_info.C_CH4_SF }}</td>
                            <td>%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <h3 class="mt-5">Denominatore Calcolo Dettagliato:</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Parametro</th>
                            <th>Valore</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>M_B_tot_denominatore</td>
                            <td>{{ debug_info.M_B_tot_denominator }}</td>
                        </tr>
                        <tr>
                            <td>phi_animal * Pg_animal * C_CH4_animal</td>
                            <td>{{ debug_info.M_B_tot_denominator_calculation['phi_LS * Pg_LS * C_CH4_LS'] }}</td>
                        </tr>
                        <tr>
                            <td>phi_crop * Pg_crop * C_CH4_crop</td>
                            <td>{{ debug_info.M_B_tot_denominator_calculation['phi_IT * Pg_IT * C_CH4_IT'] }}</td>
                        </tr>
                        <tr>
                            <td>phi_waste * Pg_waste * C_CH4_waste</td>
                            <td>{{ debug_info.M_B_tot_denominator_calculation['phi_SF * Pg_SF * C_CH4_SF'] }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <p>
                La biomassa totale è di <span>{{ M_B_tot }}</span> tonnellate al giorno, rientra nel vincolo di progetto
                (
                40 e le 70 tonnellate al giorno). Si procede con il calcolo della superficie coperta dalla coltura
                dedicata (
                relativa alla <span>{{dieta}}</span> scelta) e il calcolo dei capi da allevare per ottenere le quantità
                necessrie alla <span>{{dieta}}</span>.
            </p>
            <p>
                M_B_crop = phi_crop x M_B_tot <br> [tonn/giorno]
                M_B_animal = phi_crop x M_B_tot<br> [tonn/giorno]
                <br>
                M_B_crop = <span>{{debug_info.phi_crop}}</span> x <span>{{ M_B_tot }}</span><br> [tonn/giorno]
                M_B_animal = <span>{{debug_info.phi_animal}}</span> x <span>{{ M_B_tot }}</span> [tonn/giorno]
            </p>
            <p>
                Calcolo dei giorni di funzionamento dell'impanto a Biogas:
                N = T/24 [(h/anno)/(h/anno)] <br>
                <br>
                N = 8040/24 = 335 [giorni/anno]
                <br>
                <br>
                <span class="small">Il resto dei giorni dell'anno serviranno per la manutenzione dell'impianto e bruciare i gas in eccesso </span>
            </p>
            <p>
                Ora si passa alla stima della superficie da destinare alla coltura energetica: <br>
            </p>
            <p>
                S_crop = (M_B_crop x N)/r [((tonn/giorno)x(giorni/anno))/(tonn/(ha x anno))]
                <br><br>
                S_crop = (<span>{{ M_B_IT }} </span>x 335)/<span>{{ debug_info.resa_IT }}</span>
                <div>
                <br>
                <span class="small">in cui r = resa [tonn/(ha x annue)]</span>
            </p>
            <p>
                Infine, si stima il numero di capi necessari per ottenere la produzione di letame suino:
            </p>
            <p>
                A_capi = (M_B_animal x N)/(p_m x rho x m_c) [(tonn/anno)/((m³/(tonn_pesovivo x anno)) x (tonn/m³) x (tonn_pesovivo/capo))]
                <br>
                <br>
                A_capi = (<span>{{M_B_animal}}</span> x 335)/(<span>{{ debug_info.p_m }}</span> x <span>{{ debug_info.rho }}</span> x <span>{{ debug_info.m_c }}</span>) = <span>{{A_capi}}</span>
            </p>
        </div>
    </div>


    <div class="row">
        <div class="col-12">
            <h3 class="mt-5">Parametri della Dieta:</h3>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Parametro</th>
                            <th>Descrizione</th>
                            <th>Valore</th>
                            <th>um</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>resa_IT</td>
                            <td>Resa Colturale</td>
                            <td>{{ debug_info.resa_IT }}</td>
                            <td>ha</td>
                        </tr>
                        <tr>
                            <td>p_m</td>
                            <td>Produzione di reflui</td>
                            <td>{{ debug_info.p_m }}</td>
                            <td>ton</td>
                        </tr>
                        <tr>
                            <td>rho</td>
                            <td>Densità media refluo</td>
                            <td>{{ debug_info.rho }}</td>
                            <td>ton/m³</td>
                        </tr>
                        <tr>
                            <td>m_c</td>
                            <td>Quantità di refluo per capo</td>
                            <td>{{ debug_info.m_c }}</td>
                            <td>ton/capo</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}